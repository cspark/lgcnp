<!DOCTYPE html>
<html>
    <head>
      <script type="text/javascript" src="../js/jquery.js"></script>
      <script type="text/javascript" src="../js/bootstrap.js"></script>

      <link href="../css/bootstrap.min.css" rel="stylesheet">

      <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" type="text/css"/>
      <script src="https://code.jquery.com/ui/1.10.0/jquery-ui.min.js"></script>

      <script>
        $(function () {
          <% user = Custinfo.where(custserial: tabletinterview.custserial).first %>
          try
          {
            var userName = decode_utf8('<%= user.custname %>')
            tempUserName = ""
            for(var i = 0; i < userName.length; i++){
              if(i == 0)
                tempUserName += userName.slice(0, 1)
              else if(i == userName.length - 1)
                tempUserName += userName.slice(userName.length - 1, userName.length)
              else
                tempUserName += "*"
            }
            $('#name_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').append(tempUserName);
          }
          catch(err)
          {
            $('#name_<%= user.custserial.to_i %>_<%= user.lastanaldate %>').append('<%= user.custname %>');
          }

          //피부타입 한글로 변경
          $('#skin_type_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_skin_type('<%= tabletinterview.skin_type %>'));

          //솔루션 한글로 변경
          $('#before_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_solution('<%= tabletinterview.before_solution_1 %>'));
          $('#after_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_solution('<%= tabletinterview.after_solution_1 %>'));

          $('#before_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_solution('<%= tabletinterview.before_solution_2 %>'));
          $('#after_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_solution('<%= tabletinterview.after_solution_2 %>'));

          //세럼 한글 변경
          $('#before_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_serum('<%= tabletinterview.before_serum %>'));
          $('#after_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_serum('<%= tabletinterview.after_serum %>'));

          //앰플 한글 변경
          $('#before_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_ampoule('<%= tabletinterview.before_ample_1 %>'));
          $('#after_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_ampoule('<%= tabletinterview.after_ample_1 %>'));
          $('#before_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_ampoule('<%= tabletinterview.before_ample_2 %>'));
          $('#after_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_ampoule('<%= tabletinterview.after_ample_2 %>'));

          //제품 한글 변경
          $('#before_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_serum('<%= tabletinterview.before_made_cosmetic %>') + "Ex");
          $('#after_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>').html(translate_serum('<%= tabletinterview.after_made_cosmetic %>') + "Ex");

        });

        function decode_utf8(s) {
          return decodeURI(s);
        }

        function translate_skin_type(value){
            var skin_type = ""
            console.log(value);
            try{
              if(value.includes("skin_type_gunsung"))
                skin_type = "건성";
              else if(value.includes("skin_type_gun_boggab"))
                skin_type = "건복합성";
              else if(value.includes("skin_type_jisung"))
                skin_type = "지성";
              else if(value.includes("skin_type_jisung_boghab"))
                skin_type = "지복합성";
              else if(value.includes("skin_type_jungsung"))
                skin_type = "중성";

              if(value.includes("senstive"))
                skin_type = skin_type + " (민감성)";
            }catch(err){
              console.log(err);
              return value;
            }

            console.log(skin_type);
            return skin_type;
        }

        function translate_solution(value){
            try{
              if(value == "elasticity solution")
                return "탄력 솔루션";
              else if(value == "pigment solution")
                return "색소침착 솔루션";
              else if(value == "pore solution")
                return "모공 솔루션";
              else if(value == "trouble solution")
                return "트러블 솔루션";
              else if(value == "wrinkle solution")
                return "주름 솔루션";
              else
                return value;
            }catch(err){
              console.log(err);
              return value;
            }
        }

        function translate_serum(value){
            try{
              if(value.includes("deep humect"))
                return "딥 휴멕트 세럼";
              else if(value.includes("skin control"))
                return "스킨 컨트롤 세럼";
              else if(value.includes("rebalencing"))
                return "리밸런싱 세럼";
              else
                return value;
            }catch(err){
              console.log(err);
              return value;
            }
        }

        function translate_ampoule(value){
            try{
              if(value == "pore clinic ampoule")
                return "포어클리닉 앰플";
              else if(value == "carming ampoule")
                return "카밍 앰플";
              else if(value == "luminus ampoule")
                return "루미너스 앰플";
              else if(value == "regenerating ampoule")
                return "리제네레이팅 앰플";
              else if(value == "perming ampoule")
                return "퍼밍 앰플";
              else
                return value;
            }catch(err){
              console.log(err);
              return value;
            }
        }

        function decode_utf8(s) {
          try{
            return decodeURI(s);
          }catch(err){
            console.log(err);
            return s;
          }
        }
      </script>
    </head>
    <body>
      <% custinfo = Custinfo.where(custserial: tabletinterview.custserial).first %>
      <tr class="table_tr" id="<%= custinfo.custserial.to_i %>/<%= tabletinterview.ch_cd %>/<%= tabletinterview.fcdata_id %>">
        <td id="name_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
        <td><%= tabletinterview.custserial.to_i %></td>
        <td><%= tabletinterview.uptdate %></td>
        <td><%= custinfo.ch_cd %></td>
        <% if @select_filter != [] %>
          <% @select_filter.each do |filter| %>
            <% fcdata = Fcdata.where(custserial: tabletinterview.custserial).where(measureno: tabletinterview.fcdata_id).first %>
            <% if !fcdata.nil? %>
              <% fcdata = fcdata.to_api_hash_for_admin %>
            <% end %>  
            <% if filter.include?("skin_type") %>
              <td id="skin_type_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_solution_1") %>
              <td id="before_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_solution_1") %>
              <td id="after_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_solution_2") %>
              <td id="before_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_solution_2") %>
              <td id="after_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_serum") %>
              <td id="before_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_serum") %>
              <td id="after_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_ample_1") %>
              <td id="before_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_ample_1") %>
              <td id="after_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_ample_2") %>
              <td id="before_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_ample_2") %>
              <td id="after_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("before_made_cosmetic") %>
              <td id="before_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif filter.include?("after_made_cosmetic") %>
              <td id="after_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
            <% elsif !fcdata.nil? && filter.include?("pr_graph") %>
              <td><%= fcdata[:pr_graph].to_i %></td>
            <% elsif !fcdata.nil? && filter.include?("sb_graph") %>
              <td><%= fcdata[:sb_graph].to_i %></td>
            <% elsif !fcdata.nil? && filter.include?("pp_graph") %>
              <td><%= fcdata[:pp_graph].to_i %></td>
            <% elsif !fcdata.nil? && filter.include?("wr_graph") %>
              <td><%= fcdata[:wr_graph].to_i %></td>
            <% elsif !fcdata.nil? && filter.include?("el_graph") %>
              <td><%= fcdata[:el_graph].to_i %></td>
            <% else %>
              <td><%= tabletinterview[filter] %></td>
            <% end %>
          <% end %>
        <% else %>
          <td id="skin_type_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_solution_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_solution_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_serum_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_ampoule_1_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_ampoule_2_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="before_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td id="after_made_cosmetic_<%= tabletinterview.custserial.to_i %>_<%= tabletinterview.ch_cd %>_<%= tabletinterview.fcdata_id %>"></td>
          <td><%= tabletinterview.a_1.to_i %></td>
          <td><%= tabletinterview.a_2.to_i %></td>
          <td><%= tabletinterview.a_3.to_i %></td>
          <td><%= tabletinterview.b_1.to_i %></td>
          <td><%= tabletinterview.b_2.to_i %></td>
          <td><%= tabletinterview.b_3.to_i %></td>
          <td><%= tabletinterview.b_4.to_i %></td>
          <td><%= tabletinterview.c_1.to_i %></td>
          <td><%= tabletinterview.d_1.to_i %></td>
          <td><%= tabletinterview.d_2.to_i %></td>
          <td><%= tabletinterview.d_3.to_i %></td>
          <td><%= tabletinterview.d_4.to_i %></td>
          <td><%= tabletinterview.d_5.to_i %></td>
          <td><%= tabletinterview.d_6.to_i %></td>
          <td><%= tabletinterview.d_7.to_i %></td>
          <td><%= tabletinterview.d_8.to_i %></td>
          <td><%= tabletinterview.d_9.to_i %></td>
          <td><%= tabletinterview.d_10.to_i %></td>
          <% fcdata = Fcdata.where(custserial: tabletinterview.custserial).where(measureno: tabletinterview.fcdata_id).first %>
          <% if !fcdata.nil? %>
            <% fcdata = fcdata.to_api_hash_for_admin %>
            <td><%= fcdata[:pr_graph].to_i %></td>
            <td><%= fcdata[:sb_graph].to_i %></td>
            <td><%= fcdata[:pp_graph].to_i %></td>
            <td><%= fcdata[:wr_graph].to_i %></td>
            <td><%= fcdata[:el_graph].to_i %></td>
          <% end %>
        <% end %>
      </tr>

    </body>
</html>
