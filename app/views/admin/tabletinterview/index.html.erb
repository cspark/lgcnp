<html>
  <head>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/bootstrap.js"></script>
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" type="text/css"/>
    <script src="https://code.jquery.com/ui/1.10.0/jquery-ui.min.js"></script>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>

    <script>
      $(function () {
            $("#start_date").datepicker({
                    dateFormat: 'yy-mm-dd',
                    dayNamesMin: [
                        '일',
                        '월',
                        '화',
                        '수',
                        '목',
                        '금',
                        '토'
                    ],
                    monthNamesShort: [
                        '1월',
                        '2월',
                        '3월',
                        '4월',
                        '5월',
                        '6월',
                        '7월',
                        '8월',
                        '9월',
                        '10월',
                        '11월',
                        '12월'
                    ],
                    currentText: '오늘 날짜',
                    changeMonth: true
                });
            $("#end_date").datepicker({
                        dateFormat: 'yy-mm-dd',
                        dayNamesMin: [
                            '일',
                            '월',
                            '화',
                            '수',
                            '목',
                            '금',
                            '토'
                        ],
                        monthNamesShort: [
                            '1월',
                            '2월',
                            '3월',
                            '4월',
                            '5월',
                            '6월',
                            '7월',
                            '8월',
                            '9월',
                            '10월',
                            '11월',
                            '12월'
                        ],
                        currentText: '오늘 날짜',
                        changeMonth: true
                    });

          $("#start_date").datepicker('setDate', '<%= @start_date %>');
          $("#end_date").datepicker('setDate', '<%= @end_date %>');

          <% if !@name.nil? %>
            document.getElementById("name").value = decode_utf8('<%= @name %>')
          <% end %>

          <% if !@custserial.nil? %>
            document.getElementById("custserial").value = '<%= @custserial %>'
          <% end %>

          <% if !@select_sex.nil? %>
            $('select[id="select_sex"]').val('<%= @select_sex %>');
          <% end %>

          <% if !@start_age.nil? %>
            document.getElementById("start_age").value = '<%= @start_age %>'
          <% end %>
          <% if !@end_age.nil? %>
            document.getElementById("end_age").value = '<%= @end_age %>'
          <% end %>

          <% if !@start_birthyy.nil? %>
            document.getElementById("start_birthyy").value = '<%= @start_birthyy %>'
          <% end %>
          <% if !@end_birthyy.nil? %>
            document.getElementById("end_birthyy").value = '<%= @end_birthyy %>'
          <% end %>

          <% if !@start_birthmm.nil? %>
            document.getElementById("start_birthmm").value = '<%= @start_birthmm %>'
          <% end %>
          <% if !@end_birthmm.nil? %>
            document.getElementById("end_birthmm").value = '<%= @end_birthmm %>'
          <% end %>

          <% if !@select_channel.nil? %>
            $('select[id="select_channel"]').val('<%= @select_channel %>');
          <% end %>

          <% if !@select_mode.nil? %>
            $('select[id="select_mode"]').val('<%= @select_mode %>');
          <% end %>

          <% if !@select_makeup.nil? %>
            $('select[id="select_makeup"]').val('<%= @select_makeup %>');
          <% end %>

          <% if !@select_area.nil? %>
            $('select[id="select_area"]').val('<%= @select_area %>');
          <% end %>

          $("#date_init").click(function(){
            $("#start_date").datepicker('setDate', '<%= @start_date %>');
            $("#end_date").datepicker('setDate', '<%= @today %>');
          });

          $("#age_init").click(function(){
            document.getElementById("start_age").value = '<%= @min_age %>';
            document.getElementById("end_age").value = '<%= @max_age %>';
          });

          $("#birthyy_init").click(function(){
            document.getElementById("start_birthyy").value = '<%= @max_birthyy %>';
            document.getElementById("end_birthyy").value = '<%= @min_birthyy %>';
          });

          $("#birthmm_init").click(function(){
            document.getElementById("start_birthmm").value = '<%= @min_birthmm %>';
            document.getElementById("end_birthmm").value = '<%= @max_birthmm %>';
          });

          $('#submit').click(function(){
            load();
          });

          $(document).on("click", ".table_tr", function (e) {
            console.log("click!!!!");
            var userId = $(this).attr('id').split("/")[0]
            var ch_cd = $(this).attr('id').split("/")[1]
            var uptdate = $(this).attr('id').split("/")[2]
            console.log(userId);
            console.log(ch_cd);
            console.log(uptdate);
            window.open("/admin/tabletinterview/detail?userId=" +userId+ "&ch_cd=" +ch_cd+ "&uptdate=" +uptdate, "/users/detail?userId=" +userId+ "&ch_cd=" +ch_cd+ "&uptdate=" +uptdate, "scrollbars=1,resizable=1,height=500,width=600");
          });
      });

      function decode_utf8(s) {
        try{
          return decodeURI(s);
        }catch(err){
          console.log(err);
          return s;
        }
      }

      function load(){
        var select_sex = document.getElementById("select_sex").options[document.getElementById("select_sex").selectedIndex].value;
        var select_channel = document.getElementById("select_channel").options[document.getElementById("select_channel").selectedIndex].value;
        var select_mode = document.getElementById("select_mode").options[document.getElementById("select_mode").selectedIndex].value;
        var select_makeup = document.getElementById("select_makeup").options[document.getElementById("select_makeup").selectedIndex].value;
        var select_area = document.getElementById("select_area").options[document.getElementById("select_area").selectedIndex].value;

        url = ""
        url += "/admin/tabletinterview?start_date=" + $('#start_date').val() + "&end_date=" + $('#end_date').val();
        url += "&select_sex=" + select_sex;
        url += "&start_age=" + document.getElementById("start_age").value;
        url += "&end_age=" + document.getElementById("end_age").value;
        url += "&name=" + encodeURI(encodeURI(document.getElementById("name").value));
        url += "&custserial=" + document.getElementById("custserial").value;
        url += "&start_birthyy=" + document.getElementById("start_birthyy").value;
        url += "&end_birthyy=" + document.getElementById("end_birthyy").value;
        url += "&start_birthmm=" + document.getElementById("start_birthmm").value;
        url += "&end_birthmm=" + document.getElementById("end_birthmm").value;
        url += "&select_channel=" + select_channel;
        url += "&select_mode=" + select_mode;
        url += "&select_makeup=" + select_makeup;
        url += "&select_area=" + select_area;

        location.href = url;
      }
    </script>
    <style>
    .fixed-table-body {
      max-height: 280px;
    }

    .text-center {
        margin: 0 auto;
        text-align: center !important;
    }
    </style>
  </head>

  <body>
    <%= render "admin/header" %>

    <div id="filter" style="background: #b1cbbb; padding: 8px;">
      <div class="form-inline">
        분석일 : <input class="form-control" type="text" id="start_date" style="width:100px;">
        <input class="form-control" type="text" id="end_date" style="width:100px;">
        <button id="date_init" class="btn btn-primary">ALL</button>
        <p style="float:right; margin-right:20px;">
          Download:
          <%= link_to "Excel", admin_tabletinterview_path(format: "xlsx", :start_date => @start_date, :end_date => @end_date, :select_sex => @select_sex, :start_age => @start_age, :end_age => @end_age, :name => @name, :custserial => @custserial, :start_birthyy => @start_birthyy, :end_birthyy => @end_birthyy, :start_birthmm => @start_birthmm, :end_birthmm => @end_birthmm, :select_channel => @select_channel, :select_mode => @select_mode, :select_makeup => @select_makeup, :select_area => @select_area, :isExcel => true) %>
        </p>
      </div>

      <div class="form-inline">
        이름 :
        <input class="form-control" type="text" id="name" style="width:100px;">

        시리얼키 :
        <input class="form-control" type="text" id="custserial" style="width:100px;">

        성별 :
        <select class="form-control" id="select_sex">
          <option value="all">All</option>
          <option value="F">F</option>
          <option value="M">M</option>
        </select>

        나이 :
        <input class="form-control" type="text" id="start_age" style="width:100px; margin-top:10px;">
        <input class="form-control" type="text" id="end_age" style="width:100px; margin-top:10px;">
        <button id="age_init" class="btn btn-primary">ALL</button>

        연도 :
        <input class="form-control" type="text" id="start_birthyy" style="width:100px; margin-top:10px;">
        <input class="form-control" type="text" id="end_birthyy" style="width:100px; margin-top:10px;">
        <button id="birthyy_init" class="btn btn-primary">ALL</button>

        생월 :
        <input class="form-control" type="text" id="start_birthmm" style="width:100px; margin-top:10px;">
        <input class="form-control" type="text" id="end_birthmm" style="width:100px; margin-top:10px;">
        <button id="birthmm_init" class="btn btn-primary">ALL</button>

        채널 :
        <select class="form-control" id="select_channel">
          <option value="all">All</option>
          <option value="cnp">CNP</option>
          <option value="mart">마트</option>
          <option value="nc">NC</option>
          <option value="beau">보떼</option>
          <option value="cnprx">CNPRX</option>
        </select>
      </div>

      <div class="form-inline">
        모드 :
        <select class="form-control" id="select_mode">
          <option value="all">All</option>
          <option value="total">종합모드</option>
          <option value="quick">간편모드</option>
          <option value="makeup">메이크업모드</option>
        </select>

        메이크업 유무 :
        <select class="form-control" id="select_makeup">
          <option value="all">All</option>
          <option value="T">유</option>
          <option value="F">무</option>
        </select>

        측정부위 :
        <select class="form-control" id="select_area">
          <option value="all">All</option>
          <option value="face">전면</option>
          <option value="left">좌</option>
          <option value="right">우</option>
        </select>

        <button class="btn btn-warning" id="submit">조회</button>
      </div>
    </div>

    <table data-toggle="table" style="width:3600px;">
      <thead style="width: 100%;">
        <tr>
            <th>이름</th>
            <th>시리얼</th>
            <th>진단 날짜</th>
            <th>채널</th>
            <th>피부타입</th>
            <th>진단으로 나온 솔루션 1</th>
            <th>최종으로 선택된 솔루션 1</th>
            <th>진단으로 나온 솔루션 2</th>
            <th>최종으로 선택된 솔루션 2</th>
            <th>진단으로 나온 세럼</th>
            <th>최종으로 선택된 세럼</th>
            <th>진단으로 나온 앰플 1</th>
            <th>최종으로 선택된 앰플 1</th>
            <th>진단으로 나온 앰플 2</th>
            <th>최종으로 선택된 앰플 2</th>
            <th>진단으로 나온 화장품</th>
            <th>최종으로 선택된 화장품</th>
            <th>A1</th>
            <th>A2</th>
            <th>A3</th>
            <th>B1</th>
            <th>B2</th>
            <th>B3</th>
            <th>B4</th>
            <th>C1</th>
            <th>D1</th>
            <th>D2</th>
            <th>D3</th>
            <th>D4</th>
            <th>D5</th>
            <th>D6</th>
            <th>D7</th>
            <th>D8</th>
            <th>D9</th>
            <th>모공 점수</th>
            <th>트러블 점수</th>
            <th>색소침착 점수</th>
            <th>주름 점수</th>
            <th>탄력 점수</th>
        </tr>
      </thead>
      <tbody>
        <% @tabletinterviews.each do |tabletinterview| %>
          <%= render partial: "admin/tabletinterview/item", locals: { tabletinterview: tabletinterview } %>
        <% end %>
      </tbody>
    </table>

    <div>
      <%= paginate @tabletinterviews %>
    </div>
  </body>
</html>
